<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Club Rugby Veteranos</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f6fa; }
.header { position: relative; height: 200px; background:#2c3e50; color:#fff; display:flex; align-items:center; justify-content:center; text-align:center; }
.header img { width:100%; height:100%; object-fit:cover; position:absolute; top:0; left:0; z-index:1; }
.header h1 { position:relative; z-index:2; font-size:2em; text-shadow: 1px 1px 5px rgba(0,0,0,0.7); }
.container { max-width:800px; margin:20px auto; background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.15); }
label { font-weight:bold; display:block; margin-top:10px; }
input, textarea { width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:6px; }
button { margin-top:15px; padding:10px 15px; border:none; background:#27ae60; color:#fff; border-radius:6px; cursor:pointer; }
button:hover { background:#219150; }
</style>
</head>
<body>

<div class="header">
  <img id="portadaImg" src="" alt="Portada">
  <h1 id="clubName">Cargando club...</h1>
</div>

<div class="container" id="profileContainer">
  <h2>Perfil del Club</h2>
  <label>Nombre del Club</label>
  <input type="text" id="perfilNombre">

  <label>Dirección</label>
  <input type="text" id="perfilDireccion">

  <label>Teléfono</label>
  <input type="text" id="perfilTelefono">

  <label>Quiénes somos</label>
  <textarea id="perfilDescripcion" rows="4"></textarea>

  <label>WhatsApp</label>
  <input type="text" id="perfilWhatsapp">

  <label>Instagram</label>
  <input type="text" id="perfilInstagram">

  <label>Portada (URL)</label>
  <input type="text" id="perfilPortada">

  <button id="loginBtn">Acceso Admin</button>
  <button id="guardarBtn" style="margin-left:10px;">Guardar Perfil</button>
</div>

<script>
const API_URL = "/.netlify/functions/api";
const path = window.location.pathname;   
const username = path.slice(1);          

const perfilNombre = document.getElementById("perfilNombre");
const perfilDireccion = document.getElementById("perfilDireccion");
const perfilTelefono = document.getElementById("perfilTelefono");
const perfilDescripcion = document.getElementById("perfilDescripcion");
const perfilWhatsapp = document.getElementById("perfilWhatsapp");
const perfilInstagram = document.getElementById("perfilInstagram");
const perfilPortada = document.getElementById("perfilPortada");
const clubName = document.getElementById("clubName");
const loginBtn = document.getElementById("loginBtn");
const guardarBtn = document.getElementById("guardarBtn");
const portadaImg = document.getElementById("portadaImg");

let loggedAsAdmin = false;

// Cargar datos del club
async function cargarClub() {
  try {
    const res = await fetch(API_URL, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({action:"obtenerPerfilClub", username})
    });
    const data = await res.json();
    if(data.status==="ok") {
      clubName.textContent = data.perfil.NombreClub || username;
      perfilNombre.value = data.perfil.NombreClub || "";
      perfilDireccion.value = data.perfil.Dirección || "";
      perfilTelefono.value = data.perfil.Teléfono || "";
      perfilDescripcion.value = data.perfil.Descripción || "";
      perfilWhatsapp.value = data.perfil.WhatsApp || "";
      perfilInstagram.value = data.perfil.Instagram || "";
      perfilPortada.value = data.perfil.Portada || "";
      portadaImg.src = data.perfil.Portada || "";
      bloquearInputs();
    } else {
      clubName.textContent = "Club no encontrado";
      portadaImg.style.display="none";
    }
  } catch(err){
    console.error(err);
    clubName.textContent = "Error cargando club";
    portadaImg.style.display="none";
  }
}

function bloquearInputs(){
  perfilNombre.disabled = true;
  perfilDireccion.disabled = true;
  perfilTelefono.disabled = true;
  perfilDescripcion.disabled = true;
  perfilWhatsapp.disabled = true;
  perfilInstagram.disabled = true;
  perfilPortada.disabled = true;
}

function desbloquearInputs(){
  perfilNombre.disabled = false;
  perfilDireccion.disabled = false;
  perfilTelefono.disabled = false;
  perfilDescripcion.disabled = false;
  perfilWhatsapp.disabled = false;
  perfilInstagram.disabled = false;
  perfilPortada.disabled = false;
}

// Login admin
loginBtn.addEventListener("click", async ()=>{
  const pass = prompt("Ingrese contraseña de admin:");
  if(!pass) return;

  try{
    const res = await fetch(API_URL, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({action:"loginClub", username, password:pass})
    });
    const data = await res.json();
    if(data.status==="ok"){
      alert("Bienvenido Admin");
      desbloquearInputs();
      loggedAsAdmin = true;
    } else {
      alert("Contraseña incorrecta");
    }
  } catch(err){
    console.error(err);
    alert("Error al loguear");
  }
});

// Guardar Perfil
guardarBtn.addEventListener("click", async ()=>{
  if(!loggedAsAdmin){ alert("Debe iniciar sesión como admin"); return; }
  const perfil = {
    username,
    NombreClub: perfilNombre.value,
    Dirección: perfilDireccion.value,
    Teléfono: perfilTelefono.value,
    Descripción: perfilDescripcion.value,
    WhatsApp: perfilWhatsapp.value,
    Instagram: perfilInstagram.value,
    Portada: perfilPortada.value
  };

  try {
    const res = await fetch(API_URL, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({action:"actualizarPerfilClub", ...perfil})
    });
    const data = await res.json();
    if(data.status==="ok") {
      alert("Perfil guardado correctamente");
      portadaImg.src = perfil.Portada;
    } else alert("Error: "+data.msg);
  } catch(err){
    alert("Error al guardar: "+err.message);
  }
});

cargarClub();
</script>
</body>
</html>
